{
    "contents" : "source(\"gmmhmm.R\")\n\n\n## 测试中证500\n########################################################################\n## 0. 读取指数数据\ndata <- read.csv(\"data/NAV_5ETFs.csv\")\nzz500 <- as.xts(data[, 2], order.by=strptime(data[, 1], format=\"%Y-%m-%d\", tz=\"\"))\nzz500 <- na.omit(cbind(zz500, Return.calculate(zz500)))\nbenchmark <- as.xts(data[, 2:6], order.by=strptime(data[,1], format=\"%Y-%m-%d\", tz=\"\"))\nbenchmark_ret <- na.omit(Return.calculate(benchmark, method = \"discrete\"))\ncolnames(zz500) <- c('zz500', 'zz500.ret')\n\n\n## 1. 对中证500日回报进行分析\nlayout(rbind(c(1,2), c(3,4)))\nchart.Histogram(zz500$zz500.ret, main = \"Density\", breaks=40, methods = c(\"add.density\", \"add.normal\"))\nchart.Histogram(zz500$zz500.ret, main = \"Risk Measures\", methods = c(\"add.risk\"))\nchart.QQPlot(zz500$zz500.ret)\ntable.Stats(zz500$zz500.ret)\n\n\n## 2. 利用HMM模型来分析\n### 2.1 对单一指数的分析\n\n## case1 : 2个市场状态\ndata_case1 <- zz500$zz500.ret\ngmm <- gmm_training(data_training = data_case1, nstate = 2)\nhmm <- hmm_training(gmm, data_case1, data_case1)\n\nret_regime1 <- hmm$hmm_ret_regime[,1]\nret_regime1 <- ret_regime1[ret_regime1 != 0]\nret_regime2 <- hmm$hmm_ret_regime[,2]\nret_regime2 <- ret_regime2[ret_regime2 != 0]\n\n### 第一个图\nlayout(rbind(c(1,2),c(3,4)))\nplot.xts(zz500$zz500)\npoints(zz500$zz500[hmm$hmm_yhat==1], pch=20, col=\"black\")\nchart.Histogram(ret_regime1, main = \"Density\", breaks=40, methods = c(\"add.density\", \"add.normal\"))\nchart.Histogram(ret_regime1, main = \"Risk Measures\", methods = c(\"add.risk\"))\nchart.QQPlot(ret_regime1)\n\nlayout(rbind(c(1,2),c(3,4)))\nplot.xts(zz500$zz500)\npoints(zz500$zz500[hmm$hmm_yhat==2], pch=20, col=\"red\")\nchart.Histogram(ret_regime2, main = \"Density\", breaks=40, methods = c(\"add.density\", \"add.normal\"))\nchart.Histogram(ret_regime2, main = \"Risk Measures\", methods = c(\"add.risk\"))\nchart.QQPlot(ret_regime2)\n\n\nret_regimes <- cbind.xts(hmm$hmm_ret_regime, zz500$zz500.ret)\nret_regimes[is.na(ret_regimes)] <- 0\ncolnames(ret_regimes) <- c(\"regime 1\", \"regime 2\", \"zz500\")\ncharts.PerformanceSummary(ret_regimes)\n\ntable.Stats(ret_regimes)\ntable.AnnualizedReturns(ret_regimes)\n\n\n### casd2: 5个市场状态\ndata_case2 <- zz500$zz500.ret\ngmm <- gmm_training(data_training = data_case2, nstate = 5)\nhmm <- hmm_training(gmm, data_case2, data_case2)\n\nret_regimes <- cbind.xts(hmm$hmm_ret_regime, zz500$zz500.ret)\ncharts.PerformanceSummary(ret_regimes)\ntable.Stats(ret_regimes)\nrbind(table.AnnualizedReturns(ret_regimes), table.Distributions(ret_regimes), maxDrawdown(ret_regimes))\n\n\n### case3 : 通过单一指数， 构建复杂的训练数据集\ndata_case3 <- cbind.xts(zz500$zz500.ret, lag(zz500$zz500.ret, 1), lag(zz500$zz500.ret, 5));\nrsi <- TTR::RSI(zz500$zz500.ret) / 100 # normalize the data\nmacd <- TTR::MACD(zz500$zz500.ret)\n#data_case3 <- na.omit(cbind.xts(data_case3, rsi, macd))\ncolnames(data_case3) <- c(\"ret\", \"ret1d\", \"ret5d\")\ndata_case3 <- na.omit(data_case3)\n\n\ngmm <- gmm_training(data_training = data_case3, nstate=3)\nhmm <- hmm_training1(gmm, data_case3, data_case3[,1])\n\n\ncharts.PerformanceSummary(hmm$hmm_ret_regime)\ntable.Stats(hmm$hmm_ret_regime)\ntable.AnnualizedReturns(hmm$hmm_ret_regime)\n\n\n## out-of-sample test for 中证500\n#######################################\nsource(\"gmmhmm.R\")\ntest_oot1 <- function() {\n  data_oot <- cbind.xts(benchmark_ret[, c(1, 2, 5)], lag(benchmark_ret[,1], 1), lag(benchmark_ret[, 1], 5));\n  data_oot <- na.omit(data_oot)\n  gmmhmm(dataset = data_oot, ret_target = benchmark_ret[, 1], n_start = 1000, n_state = 5)\n}\n\ntest_oot2 <- function() {\n  ema2 <- TTR::EMA(benchmark[,1], 2);\n  data_oot <- cbind.xts(benchmark_ret[, c(1, 2, 5)],  Return.calculate(ema2), lag(benchmark_ret[,1], 1), lag(benchmark_ret[, 1], 5));\n  data_oot <- na.omit(data_oot)\n  ret <- gmmhmm(dataset = data_oot, ret_target = benchmark_ret[, 1], n_start = 1000, n_state = 5)\n  write.csv(ret, 'data/oo2_output.csv')\n}\n\n",
    "created" : 1446529087150.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1752004430",
    "id" : "9001F24F",
    "lastKnownWriteTime" : 1444366436,
    "path" : "~/Documents/Research_Projects/Trading_Strategies/HMM_Timing/hmm_test.R",
    "project_path" : "hmm_test.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_source"
}